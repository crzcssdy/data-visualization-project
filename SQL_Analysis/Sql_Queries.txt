1. Database Creation 
CREATE DATABASE fertility_db;

2. Table creation and Columns Adding 
CREATE TABLE population_fertility_gdp (
    Series_Name_x VARCHAR(255),
    Country_Name VARCHAR(255),
    Country_Code VARCHAR(255),
    Year INT,
    Fertility_Rate DECIMAL(16, 2),
    Series_Name_y VARCHAR(255),
    Series_Code VARCHAR(255),
    GDP DECIMAL(10, 2)
);


-------------------------------------------------------------------------

1. Verify the Data:

-- Check the first few rows of the table
SELECT * FROM population_fertility_gdp LIMIT 10;

-- Count how many rows are in the table
SELECT COUNT(*) FROM population_fertility_gdp;

-- Check for any missing values in key columns
SELECT 
    COUNT(*) FILTER (WHERE fertility_rate IS NULL) AS missing_fertility,
    COUNT(*) FILTER (WHERE gdp IS NULL) AS missing_gdp
FROM population_fertility_gdp;



2. Basic Analysis:

-- Calculate the average GDP and Fertility rate per country
SELECT country_name, 
       AVG(fertility_rate) AS avg_fertility_rate,
       AVG(gdp) AS avg_gdp
FROM population_fertility_gdp
GROUP BY country_name
ORDER BY avg_gdp DESC;

-------------------------------------------------------------------------------

-- Get GDP and Fertility Rate trends over the years for a specific country (e.g., Afghanistan)
SELECT year, 
       fertility_rate, 
       gdp
FROM population_fertility_gdp
WHERE country_name = 'Afghanistan'
ORDER BY year;


-- Top 10 countries with the highest fertility rate in 2023
SELECT country_name, 
       fertility_rate
FROM population_fertility_gdp
WHERE year = 2023
ORDER BY fertility_rate DESC
LIMIT 10;

-- Top 10 countries with the lowest fertility rate in 2023
SELECT country_name, 
       fertility_rate
FROM population_fertility_gdp
WHERE year = 2023
ORDER BY fertility_rate ASC
LIMIT 10;




-- Create a view that aggregates GDP and fertility rate by year and country
CREATE VIEW aggregated_data AS
SELECT country_name, 
       country_code, 
       year, 
       AVG(fertility_rate) AS avg_fertility_rate,
       AVG(gdp) AS avg_gdp
FROM population_fertility_gdp
GROUP BY country_name, country_code, year;


SELECT * FROM aggregated_data WHERE year = 2023;

